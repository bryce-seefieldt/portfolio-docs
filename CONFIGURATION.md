# Configuration Details

## Baseline Config

1. Broken links == Hard Failures.
2. Production Hosting: Vercel via Git integration a (Preview Deployments for branches and a Production Deployment for production branch i.e. `main`).
3. Autogenerated Sidebars
4. Use Categories ([`_categories_.json`](#_category_json))
5. [Mermaid Diagrams enabled]()

## `_category_.json`

### Key Policy

- Every folder that appears in the sidebar must have _category_.\*.
- Top-level domains link to curated index.md docs (type: doc).
- Subfolders default to generated-index until you need custom narrative.
- Every category index (generated or curated) must have a clear Purpose + Scope + Next Steps.
- Use slug to keep public URLs clean (avoid numeric prefixes leaking into routes).

### Sidebar Appearance

When you use an [autogenerated sidebar](https://docusaurus.io/docs/next/sidebar/autogenerated), Docusaurus treats each folder as a “category” and each Markdown file as a doc link.

Placing `_category_.json` or `_category_.yml` inside a folder lets you define category metadata, including ordering and labeling. Docusaurus explicitly documents that you can add `_category_.yml` and “specify any category metadata and also the position metadata.”

That metadata includes (common fields):

- label (what users see in the sidebar)
- position (ordering within the autogenerated slice)
- collapsible / collapsed
- optional fields like className, key, customProps

### Automatic Category “Landing Page”

[Sidebar items](https://docusaurus.io/docs/sidebar/items)

A category can be clickable and route to a page. Docusaurus supports “category links,” and notes that autogenerated categories can use _category_.yml to declare that link
The most important option is:

```yml
link: { type: 'generated-index', ... }
```

This tells Docusaurus to auto-generate an index page for the category that lists the category’s direct children.

Docusaurus even recommends generated-index as a quick way to create an “introductory document.”

This is extremely valuable for an enterprise-style docs repo: every major folder becomes a proper entry point, not just a collapsible menu.

### Formalized Ordering

Docusaurus supports ordering autogenerated sidebars using number prefixes (e.g. “00/10/20…” scaffold).

Position provides another layer of control for ordering within a folder slice.

Note: Docusaurus clarifies that position only affects the items within that sidebar.

### Content Requirements

Each navigable folder should have:

- `label`: human-friendly title (hides numeric prefixes from users)
- `position`: ordering within that folder’s autogenerated listing
- `link`: either generated-index (bootstrap/default) or doc (for curated overviews)

Docusaurus shows a canonical `_category_.json` example including `position`, `label`, `collapsible/collapsed`, and `link: { type: "generated-index", title: ... }`.

### Recommended standard

**Pattern 1: Use generated-index for most subfolders**

This is the “low-friction, always works” approach.

```json
{
  "label": "CI/CD",
  "position": 2,
  "link": {
    "type": "generated-index",
    "title": "CI/CD",
    "description": "Pipeline stages, quality gates, artifact strategy, environment promotion, and rollback procedures.",
    "slug": "/devops/ci-cd",
    "keywords": ["cicd", "github-actions", "deployment", "release"],
    "image": "/img/diagrams/c4/pipeline.png"
  }
}
```

**_Fields_**

- `title/description` makes the hub page read like a proper “section front door.” Docusaurus documents that generated-index supports title, description, slug, keywords, and image.
- `slug` prevents ugly URLs derived from filesystem naming (important when you use numeric prefixes).
- `keywords` helps site search/SEO.
- `image` gives your hubs a “product docs” feel via the card UI.

**Pattern 2: Use `doc` link for top-level sections with curated overview pages**

For a custom “executive summary” page (highly recommended for `00-portfolio`, `10-architecture`, `40-security`, `50-operations`), link the category to that doc instead of generated index.

Docusaurus supports category links to an existing doc (`type: 'doc', id: ...`).

Also note: doc links can be resolved relatively within autogenerated categories, which makes maintenance easier.

```json
{
  "label": "Security",
  "position": 40,
  "link": { "type": "doc", "id": "40-security/index" }
}
```

Now `docs/40-security/index.md` becomes the “Security front door” with:

- security objectives and assumptions
- threat model pointers
- SDLC controls checklist
- links to scan evidence
- and a structured list of subpages

**Tip:** For the nice generated “cards list” on that curated index page, you can embed `DocCardList` in the doc page itself. Docusaurus documents `DocCardList` for embedding the category card list inside a normal doc page

**Advanced: using `customProps` for maturity/ownership signals**

Docusaurus shows `customProps` in `_category_` metadata and notes it can be used if you customize (“swizzle”) the DocCard rendering.

For enterprise-level polish, use `customProps` to record (and later render):

- `owner`: “Platform / DevOps”
- `maturity`: draft | beta | stable
- `lastReviewed`: YYYY-MM-DD

Provides “evidence dashboard” feel without inventing a separate system.

## Environment Variables Configuration

The Portfolio Docs App uses environment variables to support portability across local, preview, and production environments.

### Variable Prefix Convention

Docusaurus uses `DOCUSAURUS_` prefix convention for client-exposed variables:

- **`DOCUSAURUS_*`**: Exposed to client-side code (browser)
- **Non-prefixed**: Build-time only (server-side, not available in React)

This is analogous to Next.js `NEXT_PUBLIC_*` convention.

### Core Variables

#### `DOCUSAURUS_SITE_URL`

- **Purpose**: Base URL of the deployed site (SEO, sitemap, canonical URLs)
- **Local**: `http://localhost:3000`
- **Production**: `https://bns-portfolio-docs.vercel.app`
- **Default**: `https://bns-portfolio-docs.vercel.app` (fallback if not set)

#### `DOCUSAURUS_BASE_URL`

- **Purpose**: Base path under which site is served (for subpath deployments)
- **Default**: `/` (root)
- **Use case**: GitHub Pages subpath like `/portfolio-docs/`

#### `DOCUSAURUS_GITHUB_ORG`, `DOCUSAURUS_GITHUB_REPO_DOCS`, `DOCUSAURUS_GITHUB_REPO_APP`

- **Purpose**: GitHub organization and repository names for linking
- **Used in**: GitHub URLs, edit links, navbar/footer links
- **Default values**: `bryce-seefieldt`, `portfolio-docs`, `portfolio-app`

#### `DOCUSAURUS_PORTFOLIO_APP_URL`

- **Purpose**: URL of the Portfolio App for cross-linking from docs to live app
- **Local**: `http://localhost:3000`
- **Production**: `https://bns-portfolio-app.vercel.app`

### File Structure

- **`.env.example`**: Template with placeholder values (committed to repo)
- **`.env.local`**: Local development overrides (gitignored, not committed)
- **`.env.production.local`** (optional): Production-specific overrides (gitignored)

### Local Development Setup

```bash
# Copy template
cp .env.example .env.local

# Edit with local values
DOCUSAURUS_SITE_URL=http://localhost:3000
DOCUSAURUS_GITHUB_ORG=your-username
DOCUSAURUS_GITHUB_REPO_DOCS=portfolio-docs
DOCUSAURUS_GITHUB_REPO_APP=portfolio-app
```

### Production Configuration (Vercel)

Set environment variables in Vercel Dashboard under **Settings → Environment Variables**:

```
DOCUSAURUS_SITE_URL=https://bns-portfolio-docs.vercel.app
DOCUSAURUS_BASE_URL=/
DOCUSAURUS_GITHUB_ORG=bryce-seefieldt
DOCUSAURUS_GITHUB_REPO_DOCS=portfolio-docs
DOCUSAURUS_GITHUB_REPO_APP=portfolio-app
DOCUSAURUS_PORTFOLIO_APP_URL=https://bns-portfolio-app.vercel.app
```

### Full Documentation

See [Portfolio Docs Environment Variables Contract](./docs/_meta/env/portfolio-docs-env-contract.md) for:

- Complete variable reference
- Environment-specific examples
- React component access via `customFields`
- File precedence rules
- Security notes

## CI and Deployment Configuration

### Hard build gate (broken links == failure)

- `docusaurus.config.ts` sets `onBrokenLinks: 'throw'`
- This means the build fails if:
  - any internal link target does not exist
  - any doc ID in `_category_.json` link is missing
  - any anchor link is invalid
- This is **intentional and by design**; broken links are a hard failure
- See [ADR-0003: Hosting Vercel with Preview Deployments](./docs/10-architecture/adr/adr-0003-hosting-vercel-with-preview-deployments.md) for rationale

### Vercel Deployment Checks

**Purpose:** decouple deployment creation from production release

**Configuration:**

- Vercel Git integration detects pushes to `main`
- Production deployment created immediately
- GitHub Actions `ci / build` workflow runs (required check)
- Vercel assigns production domain only when checks pass
- If checks fail: deployment exists but remains unpromoted

**Learn more:**

- [Deployment Checks flow diagram and explanation](./docs/60-projects/portfolio-docs-app/03-deployment.md#release-governance-vercel-deployment-checks)
- [Deploy runbook](./docs/50-operations/runbooks/rbk-docs-deploy.md) with validation steps

### Build determinism: pnpm + Corepack

**Package manager pinning via `package.json`:**

```json
{
  "packageManager": "pnpm@10.0.0",
  "engines": { "node": ">=20.0" }
}
```

**Vercel environment variable:**

```
ENABLE_EXPERIMENTAL_COREPACK=1
```

**Purpose:**

- Ensures identical pnpm version across local, CI, and Vercel
- Prevents "works on my machine but fails in CI" issues
- Corepack is Node's native package manager version manager

**Learn more:**

- [Build Determinism details](./docs/60-projects/portfolio-docs-app/03-deployment.md#build-determinism-pnpm--corepack) in deployment dossier
- [Risk/benefit assessment for experimental Corepack](./docs/10-architecture/adr/adr-0003-hosting-vercel-with-preview-deployments.md#corepack-integration-experimental)

## Enable Mermaid diagrams (architecture & flows)

[Mermaid Diagram and Charting Tool](https://mermaid.js.org/)

- Install the **Mermaid theme package**
- [Enable diagrams](https://docusaurus.io/docs/next/markdown-features/diagrams) (theme config supports Mermaid theming)
