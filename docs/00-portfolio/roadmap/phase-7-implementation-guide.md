---
title: 'Phase 7 Implementation Guide: Coverage Expansion, Docs Governance, and Archival Hardening'
description: 'Summarize and operationalize post-Phase 6 changes across portfolio-app and portfolio-docs, including test coverage expansion, governance docs updates, and archive enforcement.'
sidebar_position: 7
tags: ['phase-7', 'implementation', 'planning', 'governance']
---

# Phase 7 Implementation Guide — Coverage Expansion, Docs Governance, and Archival Hardening

**Phase:** Phase 7 (Post-Phase 6 hardening)
**Estimated Duration:** 8-12 hours (2-3 hours/week assuming 4 weeks)
**Status:** In Progress
**Last Updated:** 2026-02-06

## Purpose

Phase 7 documents and operationalizes the changes implemented after Phase 6 completion. It captures testing expansion in the app, governance and testing documentation updates in the docs site, and a hardened archival approach that removes closed issues from the rendered build while preserving traceability.

## What Phase 7 Delivers

- **App test expansion:** Broader unit coverage across pages, components, data wrappers, API routes, and middleware.
- **Docs governance refresh:** Testing guide updates, ADR-0020, and quality gate references aligned with `ci / test`.
- **Archival hardening:** Formal archive options documented and closed issues moved to an excluded archive path.

---

## Prerequisites

Before starting Phase 7, ensure:

- ✅ Phase 6 complete and verified
- ✅ Portfolio app and docs repos are on `main`
- ✅ CI gate naming is stable (`ci / quality`, `ci / test`, `ci / build`)
- ✅ Archival policy and runbook exist (Phase 6 deliverables)

**Verification checklist:**

```bash
# From portfolio-app
pnpm lint
pnpm typecheck
pnpm test:coverage

# From portfolio-docs
pnpm build
```

---

## Implementation Overview

### Two approaches to Phase 7 structure:

**Option A: Sequential Steps**

- Use if app and docs changes must land in strict order
- Example: app tests first, docs references second, archival changes last

**Option B: Parallel Stages (recommended)**

- Use if app, docs, and archival changes can proceed independently
- Example: app test expansion, docs governance updates, and archival hardening in parallel

---

## APPROACH B: Modular Stages Implementation

### Stage 7.1: Portfolio App Test Coverage Expansion (3-4 hours)

**What:** Expand unit tests to cover App Router pages, UI components, API route handlers, data wrappers, and middleware.

**Key Files/Components:**

- Create/Modify: `src/app/__tests__/`
- Create/Modify: `src/components/__tests__/`
- Create/Modify: `src/app/api/__tests__/`
- Create/Modify: `src/data/__tests__/`
- Create/Modify: `src/__tests__/proxy.test.ts`
- Update: `vitest.config.ts`, `src/test/setup.ts`, `tsconfig.json`

**Design Specifications:**

- Default Vitest environment remains `node`.
- UI tests opt into jsdom via `// @vitest-environment jsdom`.
- Coverage scope includes `src/**/*.{ts,tsx}` with test/setup exclusions.

**Validation Rules:**

- Coverage thresholds: 95% lines/functions/branches/statements.
- Mocking must avoid hoisting pitfalls (`vi.hoisted` when needed).

**CI Integration:**

- `ci / test` runs `pnpm test:unit` and `pnpm test:e2e`.
- Coverage reports generated by `pnpm test:coverage`.

**Deliverables:**

- ✅ Expanded unit tests across routes/components/API/data
- ✅ Coverage scope widened to full `src`
- ✅ Shared jsdom setup via `src/test/setup.ts`

**Success check:**

- [ ] `pnpm test:coverage` passes locally
- [ ] Coverage >= 95% across all tracked modules
- [ ] PR created with title: `test: expand coverage and CI gate docs`

---

### Stage 7.2: Docs Governance and Testing Updates (3-4 hours)

**What:** Align testing documentation and CI guidance with expanded coverage and `ci / test` gate, and add ADR-0020 for UI/route unit testing strategy.

**Key Files/Components:**

- Create/Modify: `docs/70-reference/testing-guide.md`
- Create/Modify: `docs/60-projects/portfolio-app/05-testing.md`
- Create/Modify: `docs/00-portfolio/features/07-testing-quality-gates/`
- Create/Modify: `docs/50-operations/runbooks/rbk-portfolio-ci-triage.md`
- Create: `docs/10-architecture/adr/adr-0020-portfolio-app-ui-testing-strategy.md`
- Update: `docs/10-architecture/adr/index.md`

**Design Specifications:**

- Document coverage scope as `src/**/*.{ts,tsx}`.
- Update test counts and examples to current totals.
- Add ADR for UI/route test strategy and rationale.

**Validation Rules:**

- All docs should follow standard structure and have front matter.
- Cross-links must resolve without broken-link errors.

**CI Integration:**

- Docs CI uses `pnpm build` for broken link checks.

**Deliverables:**

- ✅ Testing guide updated with current coverage scope and jsdom guidance
- ✅ CI triage runbook includes `ci / test` gate
- ✅ ADR-0020 published and linked in ADR index

**Success check:**

- [ ] `pnpm build` passes
- [ ] PR created with title: `docs: update testing gates and ADR-0020`

---

### Stage 7.3: Archival Hardening (2-4 hours)

**What:** Implement a non-rendering archival strategy for closed roadmap issues and document archive visibility options.

**Key Files/Components:**

- Update: `docs/00-portfolio/portfolio-archival-policy.md`
- Update: `docs/50-operations/runbooks/rbk-portfolio-archival.md`
- Move: `docs/00-portfolio/roadmap/issues/` -> `docs/_archive/closed-issues/`
- Update: `docusaurus.config.ts` (exclude archive path)
- Update: `docs/00-portfolio/release-notes/20260206-portfolio-roadmap-issues-archived.md`

**Design Specifications:**

- Archive option 1: mark pages as `draft: true` to skip rendering.
- Archive option 2: move to `docs/_archive/` and exclude from build.

**Validation Rules:**

- Archived content remains accessible in repo history.
- Rendered docs omit archived issue pages.

**CI Integration:**

- Docs build excludes `docs/_archive/**`.

**Deliverables:**

- ✅ Archive policy/runbook document both options
- ✅ Closed issues moved to `docs/_archive/closed-issues/`
- ✅ Archive path excluded from docs build

**Success check:**

- [ ] `pnpm build` passes
- [ ] Archived issues no longer render in deployed docs

---

## Implementation Checklist

### Pre-Implementation

- [ ] Phase 6 verified on `main`
- [ ] Agree Phase 7 scope (testing + docs + archival)
- [ ] Create tracking issues per stage
- [ ] Review and approve this implementation guide

### Stage 7.1 Checklist

- [ ] Tests added for pages/components/API/data
- [ ] Coverage scope widened to full `src`
- [ ] Local verification: `pnpm test:coverage`
- [ ] PR created and reviewed

### Stage 7.2 Checklist

- [ ] Testing guide updated
- [ ] CI triage runbook updated for `ci / test`
- [ ] ADR-0020 published and linked
- [ ] Local verification: `pnpm build`
- [ ] PR created and reviewed

### Stage 7.3 Checklist

- [ ] Archive options documented in policy/runbook
- [ ] Issues moved to `docs/_archive/closed-issues/`
- [ ] Docusaurus exclude configured
- [ ] Release note updated
- [ ] Local verification: `pnpm build`

### Post-Implementation

- [ ] All PRs merged to `main`
- [ ] All CI checks passing
- [ ] Deployments successful (docs, then app)
- [ ] Release notes updated

---

## Timeline & Resource Estimate

| Step/Stage | Task                                        | Duration | Status    | Notes |
| ---------- | ------------------------------------------- | -------- | --------- | ----- |
| 7.1        | App test coverage expansion                  | 3-4h     | In Progress | —   |
| 7.2        | Docs testing governance updates + ADR-0020  | 3-4h     | In Progress | —   |
| 7.3        | Archival hardening and build exclusion      | 2-4h     | In Progress | —   |
| **Total**  | **Phase 7 Complete**                         | **8-12h**| **In Progress** | — |

**Resource allocation:**

- **Personnel:** Portfolio maintainer: 2-3 hours/week
- **Dependencies:** None external
- **Risk factors:** Broken links after archival; coverage drift if tests regress

---

## Success Criteria

Phase 7 is complete when:

- ✅ App unit coverage meets or exceeds 95% across full `src`
- ✅ Docs reflect current testing scope and CI gates
- ✅ Archive policy/runbook document both visibility options
- ✅ Archived issues no longer render in the deployed docs
- ✅ Docs build passes without broken links

---

## Acceptance Criteria (Reviewability)

A reviewer can validate Phase 7 completion through:

- **Functionality:** Tests cover routes/components/API/middleware
- **Quality:** `pnpm lint`, `pnpm typecheck`, `pnpm test:coverage` pass
- **Documentation:** Testing guide, ADR-0020, and runbooks updated
- **Operations:** Archival policy/runbook and release notes reflect archive strategy

---

## Implementation Artifacts

### Code Deliverables

- `portfolio-app/src/app/__tests__/` (page coverage)
- `portfolio-app/src/components/__tests__/` (component coverage)
- `portfolio-app/src/app/api/__tests__/` (route handler coverage)
- `portfolio-app/src/data/__tests__/` (data wrapper coverage)
- `portfolio-app/src/__tests__/proxy.test.ts` (middleware coverage)

### Documentation Deliverables

- ADR-0020 (UI and route testing strategy)
- Testing guide updates and CI triage runbook updates
- Archive policy/runbook updates for visibility options
- Release note: `20260206-portfolio-roadmap-issues-archived.md`

### Testing Deliverables

- Coverage scope expanded to `src/**/*.{ts,tsx}`
- jsdom setup documented and shared via `src/test/setup.ts`

---

## Key Architecture Decisions

- **Decision 1:** Expand unit test coverage to include UI, routes, API handlers, and data wrappers.
  - **Rationale:** Close coverage gaps and enforce the `ci / test` gate for all core surfaces.
  - **Alternative considered:** Keep coverage limited to `src/lib` only.
  - **Implications:** Requires jsdom tooling and additional tests.

- **Decision 2:** Archive closed issues under `docs/_archive/` and exclude them from build.
  - **Rationale:** Preserve traceability without surfacing stale issues in docs navigation.
  - **Alternative considered:** Draft-only archival without file movement.
  - **Implications:** Requires Docusaurus exclude configuration and link audits.

---

## Dependency Graph & Sequencing

```
Stage 7.1 (App Tests)    Stage 7.2 (Docs Updates)    Stage 7.3 (Archive Hardening)
      |                          |                           |
      +----------- parallel ------+----------- parallel -------+
                      |
                Phase 7 Completion
```

---

## Risk Mitigation

| Risk                            | Likelihood | Impact | Mitigation                                 |
| ------------------------------- | ---------- | ------ | ------------------------------------------ |
| Coverage thresholds regress     | Med        | High   | Run `pnpm test:coverage` before merge      |
| Broken links after archive move | Low        | High   | Run `pnpm build` and update inbound links  |
| Archive visibility confusion    | Med        | Med    | Document options in policy and runbook     |

---

## Communication & Coordination

### Review Gates

- **Mid-phase review:** After Stage 7.2
  - Participants: Portfolio maintainer
  - Artifacts: ADR-0020, testing guide updates

- **End-of-phase review:** After all stages
  - Participants: Portfolio maintainer
  - Artifacts: Release note and archive policy/runbook updates

### Deployment Sequence

1. Merge docs PRs to `main`
2. Deploy portfolio-docs
3. Merge app PRs to `main`
4. Deploy portfolio-app
5. Verify production navigation and links

---

## Tooling & Scripts

**Available commands:**

```bash
# portfolio-app
pnpm lint
pnpm typecheck
pnpm test:coverage

# portfolio-docs
pnpm build
```

---

## Reference Documentation

- Roadmap hub: /docs/00-portfolio/roadmap/index.md
- ADR index: /docs/10-architecture/adr/index.md
- Testing guide: /docs/70-reference/testing-guide.md
- Archival policy: /docs/00-portfolio/portfolio-archival-policy.md
- Archival runbook: /docs/50-operations/runbooks/rbk-portfolio-archival.md

---

## Notes & Assumptions

- Assumes Phase 6 governance artifacts are stable.
- Assumes archive exclusion does not break required evidence links.

---

**Document Status:** Draft
**Last Reviewed:** 2026-02-06
**Next Review:** As needed
